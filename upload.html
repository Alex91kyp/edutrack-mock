<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyser une copie - EduTrack AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation Sidebar -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="hidden md:flex md:w-64 md:flex-col">
            <div class="flex flex-col flex-grow pt-5 bg-white border-r border-gray-200 shadow-sm">
                <!-- Logo -->
                <div class="flex items-center flex-shrink-0 px-6">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <i data-feather="brain" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="ml-3 text-lg font-semibold text-gray-800">EduTrack AI</span>
                </div>
                
                <!-- User Info -->
                <div class="px-6 mt-6">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i data-feather="user" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-800">M. Lefèvre</p>
                            <p class="text-xs text-gray-500">Professeur de Français</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Menu -->
                <nav class="mt-8 flex-1">
                    <div class="px-3 space-y-1">
                        <a href="dashboard.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="layout" class="mr-3 w-5 h-5"></i>
                            Tableau de bord
                        </a>
                        <a href="eleve.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="users" class="mr-3 w-5 h-5"></i>
                            Mes élèves
                        </a>
                        <a href="upload.html" class="bg-blue-50 text-blue-700 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="upload" class="mr-3 w-5 h-5"></i>
                            Analyser une copie
                        </a>
                        <a href="rapport.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="file-text" class="mr-3 w-5 h-5"></i>
                            Rapports
                        </a>
                        <a href="comparaison.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="bar-chart-2" class="mr-3 w-5 h-5"></i>
                            Statistiques
                        </a>
                        <a href="prevision.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                            <i data-feather="trending-up" class="mr-3 w-5 h-5"></i>
                            Prévisions IA
                        </a>
                    </div>
                    
                    <!-- Divider -->
                    <div class="mt-8 pt-6 border-t border-gray-200 px-3">
                        <div class="space-y-1">
                            <a href="fiches.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="bookmark" class="mr-3 w-5 h-5"></i>
                                Fiches de révision
                            </a>
                            <a href="exercices.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="edit-3" class="mr-3 w-5 h-5"></i>
                                Exercices générés
                            </a>
                            <a href="parents.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="mail" class="mr-3 w-5 h-5"></i>
                                Rapports parents
                            </a>
                        </div>
                    </div>

                    <!-- Bottom Section -->
                    <div class="mt-auto pb-4 px-3">
                        <div class="space-y-1">
                            <a href="ethique.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="shield" class="mr-3 w-5 h-5"></i>
                                Éthique & RGPD
                            </a>
                            <a href="roadmap.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="map" class="mr-3 w-5 h-5"></i>
                                Roadmap
                            </a>
                            <a href="index.html" class="text-gray-700 hover:bg-gray-50 group flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                                <i data-feather="home" class="mr-3 w-5 h-5"></i>
                                Retour accueil
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Nouvelle copie à analyser</h1>
                            <p class="text-gray-600">Uploadez une copie pour obtenir une analyse IA instantanée</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <a href="dashboard.html" class="text-gray-500 hover:text-gray-700">
                                <i data-feather="arrow-left" class="w-5 h-5"></i>
                            </a>
                            <button class="md:hidden text-gray-500" id="mobile-sidebar-btn">
                                <i data-feather="menu" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="p-6">
                <div class="max-w-4xl mx-auto">
                    <!-- Upload Form -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                        <div class="p-6 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Informations du devoir</h2>
                            <p class="text-sm text-gray-600 mt-1">Renseignez les détails avant l'upload</p>
                        </div>
                        
                        <div class="p-6">
                            <form id="uploadForm" class="space-y-6">
                                <!-- Student Selection -->
                                <div>
                                    <label for="student" class="block text-sm font-medium text-gray-700 mb-2">
                                        Élève <span class="text-red-500">*</span>
                                    </label>
                                    <select id="student" name="student" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                        <option value="">Sélectionnez un élève...</option>
                                        <option value="lucas-dubois">Lucas Dubois - 3ème A</option>
                                        <option value="sarah-martin">Sarah Martin - 3ème A</option>
                                        <option value="thomas-caron">Thomas Caron - 3ème A</option>
                                        <option value="emma-blanchard">Emma Blanchard - 3ème A</option>
                                        <option value="antoine-mercier">Antoine Mercier - 3ème A</option>
                                        <option value="julie-bernard">Julie Bernard - 3ème A</option>
                                        <option value="maxime-roux">Maxime Roux - 3ème A</option>
                                        <option value="lea-moreau">Léa Moreau - 3ème A</option>
                                        <option value="paul-david">Paul David - 3ème B</option>
                                        <option value="chloe-petit">Chloé Petit - 3ème B</option>
                                    </select>
                                    
                                    <!-- Auto-detection Option -->
                                    <div class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                                        <div class="flex items-start">
                                            <input 
                                                type="checkbox" 
                                                id="autoDetectStudent" 
                                                name="autoDetectStudent" 
                                                class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                            >
                                            <div class="ml-3">
                                                <label for="autoDetectStudent" class="text-sm font-medium text-gray-700">
                                                    Laisser l'IA détecter automatiquement le nom de l'élève dans la copie (optionnel)
                                                </label>
                                                <p class="text-xs text-gray-500 mt-2 leading-relaxed">
                                                    <i data-feather="shield" class="w-3 h-3 inline-block mr-1"></i>
                                                    <strong>Note RGPD :</strong> Cette fonctionnalité est optionnelle. Le nom extrait n'est pas conservé et ne sert qu'à associer la copie à l'élève correct. Vous pouvez désactiver cette option à tout moment.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Assignment Name -->
                                <div>
                                    <label for="assignment" class="block text-sm font-medium text-gray-700 mb-2">
                                        Nom du devoir <span class="text-red-500">*</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        id="assignment" 
                                        name="assignment" 
                                        required 
                                        placeholder="Ex: Contrôle de grammaire - 12/04/2025"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                </div>

                                <!-- Subject/Type -->
                                <div>
                                    <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                                        Type d'évaluation
                                    </label>
                                    <select id="subject" name="subject" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                        <option value="">Sélectionnez un type...</option>
                                        <option value="redaction">Rédaction</option>
                                        <option value="dictee">Dictée</option>
                                        <option value="grammaire">Grammaire</option>
                                        <option value="conjugaison">Conjugaison</option>
                                        <option value="vocabulaire">Vocabulaire</option>
                                        <option value="litterature">Littérature</option>
                                        <option value="expression-ecrite">Expression écrite</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>

                                <!-- File Upload Zone -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Fichier de la copie <span class="text-red-500">*</span>
                                    </label>
                                    <div 
                                        id="dropZone" 
                                        class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer bg-gray-50 hover:bg-blue-50"
                                    >
                                        <div id="dropContent">
                                            <i data-feather="upload-cloud" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                            <h3 class="text-lg font-medium text-gray-700 mb-2">Glissez-déposez votre fichier ici</h3>
                                            <p class="text-gray-500 mb-4">ou cliquez pour parcourir</p>
                                            <p class="text-sm text-gray-400">Formats acceptés: PDF, JPG, PNG (max 10 MB)</p>
                                        </div>
                                        <div id="filePreview" class="hidden">
                                            <div class="flex items-center justify-center space-x-3">
                                                <i data-feather="file" class="w-8 h-8 text-blue-600"></i>
                                                <div class="text-left">
                                                    <p id="fileName" class="font-medium text-gray-800"></p>
                                                    <p id="fileSize" class="text-sm text-gray-500"></p>
                                                </div>
                                                <button type="button" id="removeFile" class="text-red-500 hover:text-red-700">
                                                    <i data-feather="x" class="w-5 h-5"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="file" id="fileInput" name="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden">
                                </div>

                                <!-- AI Analysis Option -->
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <div class="flex items-start">
                                        <input 
                                            type="checkbox" 
                                            id="autoAnalysis" 
                                            name="autoAnalysis" 
                                            checked 
                                            class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                        >
                                        <div class="ml-3">
                                            <label for="autoAnalysis" class="text-sm font-medium text-blue-800">
                                                Analyse IA automatique dès upload
                                            </label>
                                            <p class="text-xs text-blue-600 mt-1">
                                                L'IA analysera automatiquement la copie : orthographe, grammaire, structure, et génèrera un rapport complet.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="flex justify-end space-x-3">
                                    <a href="dashboard.html" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                                        Annuler
                                    </a>
                                    <button 
                                        type="submit" 
                                        id="submitBtn"
                                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        <span id="submitText">Analyser la copie</span>
                                        <i data-feather="arrow-right" class="w-5 h-5 ml-2 inline-block"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Progress Section (initially hidden) -->
                    <div id="progressSection" class="mt-6 bg-white rounded-xl shadow-sm border border-gray-100 hidden">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <div class="w-6 h-6 loading-spinner border-2 border-blue-600 border-t-transparent rounded-full mr-3"></div>
                                Analyse en cours...
                            </h3>
                            
                            <div class="space-y-4">
                                <!-- Progress Steps -->
                                <div class="space-y-3">
                                    <div id="step1" class="flex items-center text-gray-500">
                                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                            <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                                        </div>
                                        <span>Upload du fichier...</span>
                                    </div>
                                    
                                    <div id="step2" class="flex items-center text-gray-500">
                                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                            <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                                        </div>
                                        <span>Reconnaissance OCR...</span>
                                    </div>
                                    
                                    <div id="step3" class="flex items-center text-gray-500">
                                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                            <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                                        </div>
                                        <span>Analyse linguistique IA...</span>
                                    </div>
                                    
                                    <div id="step4" class="flex items-center text-gray-500">
                                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                            <div class="w-2 h-2 bg-gray-300 rounded-full"></div>
                                        </div>
                                        <span>Génération du rapport...</span>
                                    </div>
                                </div>

                                <!-- Progress Bar -->
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="progressBar" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                                </div>
                                
                                <p id="progressText" class="text-sm text-gray-600 text-center">Initialisation...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Success Section (initially hidden) -->
                    <div id="successSection" class="mt-6 bg-green-50 border border-green-200 rounded-xl p-6 hidden">
                        <div class="flex items-start">
                            <i data-feather="check-circle" class="w-6 h-6 text-green-600 mt-1 mr-3"></i>
                            <div>
                                <h3 class="text-lg font-semibold text-green-800 mb-2">Analyse terminée avec succès !</h3>
                                <p class="text-green-700 mb-4">La copie a été analysée par notre IA. Voici un aperçu des résultats :</p>
                                
                                <div class="grid md:grid-cols-3 gap-4 mb-6">
                                    <div class="bg-white p-4 rounded-lg shadow-sm">
                                        <p class="text-sm text-gray-600">Note estimée</p>
                                        <p class="text-2xl font-bold text-gray-800">14<span class="text-lg">/20</span></p>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg shadow-sm">
                                        <p class="text-sm text-gray-600">Erreurs détectées</p>
                                        <p class="text-2xl font-bold text-gray-800">7</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg shadow-sm">
                                        <p class="text-sm text-gray-600">Points forts</p>
                                        <p class="text-2xl font-bold text-gray-800">3</p>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <a href="rapport.html" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">
                                        Voir le rapport complet
                                    </a>
                                    <button onclick="startNewAnalysis()" class="bg-white text-green-600 px-4 py-2 rounded-lg border border-green-600 hover:bg-green-50 transition-colors font-medium">
                                        Analyser une autre copie
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Help Section -->
                    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                            <i data-feather="help-circle" class="w-5 h-5 mr-2"></i>
                            Conseils pour une meilleure analyse
                        </h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-700">
                            <div class="space-y-2">
                                <p><strong>✓ Qualité d'image :</strong> Utilisez une résolution d'au moins 300 DPI</p>
                                <p><strong>✓ Éclairage :</strong> Évitez les reflets et ombres</p>
                                <p><strong>✓ Orientation :</strong> Assurez-vous que le texte est bien droit</p>
                            </div>
                            <div class="space-y-2">
                                <p><strong>✓ Format :</strong> PDF recommandé pour les documents multipages</p>
                                <p><strong>✓ Taille :</strong> Maximum 10 MB par fichier</p>
                                <p><strong>✓ Lisibilité :</strong> Vérifiez que l'écriture est bien visible</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="scripts.js"></script>
    <script>
        // Initialize Feather icons
        feather.replace();
        
        // Re-render icons after any dynamic content changes
        setTimeout(() => feather.replace(), 100);

        // File upload handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const dropContent = document.getElementById('dropContent');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFileBtn = document.getElementById('removeFile');
        const uploadForm = document.getElementById('uploadForm');
        const progressSection = document.getElementById('progressSection');
        const successSection = document.getElementById('successSection');

        // Drag and drop events
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-100');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-500', 'bg-blue-100');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-100');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        removeFileBtn.addEventListener('click', () => {
            fileInput.value = '';
            dropContent.classList.remove('hidden');
            filePreview.classList.add('hidden');
        });

        function handleFile(file) {
            // Validate file
            const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            if (!validTypes.includes(file.type)) {
                EduTrackAI.showNotification('Format de fichier non supporté', 'error');
                return;
            }

            if (file.size > maxSize) {
                EduTrackAI.showNotification('Fichier trop volumineux (max 10MB)', 'error');
                return;
            }

            // Display file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            dropContent.classList.add('hidden');
            filePreview.classList.remove('hidden');
            feather.replace();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Form submission
        uploadForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Validate form
            const student = document.getElementById('student').value;
            const assignment = document.getElementById('assignment').value;
            const file = fileInput.files[0];
            const autoDetect = document.getElementById('autoDetectStudent').checked;

            // Check required fields (student is optional if auto-detection is enabled)
            if ((!student && !autoDetect) || !assignment || !file) {
                let message = 'Veuillez remplir tous les champs obligatoires';
                if (!student && !autoDetect) {
                    message = 'Veuillez sélectionner un élève ou activer la détection automatique';
                }
                EduTrackAI.showNotification(message, 'warning');
                return;
            }

            // Start analysis simulation
            startAnalysis();
        });

        function startAnalysis() {
            // Hide form and show progress
            uploadForm.parentElement.style.display = 'none';
            progressSection.classList.remove('hidden');
            
            // Check if auto-detection is enabled to modify steps
            const autoDetect = document.getElementById('autoDetectStudent').checked;
            
            // Simulate analysis steps (adapt based on auto-detection)
            const steps = ['step1', 'step2', 'step3', 'step4'];
            let stepTexts = [
                'Upload du fichier...',
                'Reconnaissance OCR en cours...',
                'Analyse linguistique par IA...',
                'Génération du rapport final...'
            ];
            
            if (autoDetect) {
                stepTexts[1] = 'Reconnaissance OCR et détection du nom...';
                stepTexts[2] = 'Analyse linguistique par IA...';
            }
            
            let currentStep = 0;
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            function nextStep() {
                if (currentStep < steps.length) {
                    // Complete current step
                    const stepElement = document.getElementById(steps[currentStep]);
                    stepElement.classList.remove('text-gray-500');
                    stepElement.classList.add('text-green-600');
                    stepElement.querySelector('.w-6').classList.remove('border-gray-300');
                    stepElement.querySelector('.w-6').classList.add('border-green-500', 'bg-green-500');
                    stepElement.querySelector('.w-2').classList.remove('bg-gray-300');
                    stepElement.querySelector('.w-2').classList.add('bg-white');
                    
                    // Special notification for name detection
                    if (autoDetect && currentStep === 1) {
                        setTimeout(() => {
                            EduTrackAI.showNotification('Nom détecté : Lucas Dubois (3ème A)', 'success');
                        }, 800);
                    }
                    
                    // Update progress
                    const progress = ((currentStep + 1) / steps.length) * 100;
                    progressBar.style.width = progress + '%';
                    progressText.textContent = stepTexts[currentStep];
                    
                    currentStep++;
                    
                    if (currentStep < steps.length) {
                        setTimeout(nextStep, 1500 + Math.random() * 1000);
                    } else {
                        setTimeout(showSuccess, 1000);
                    }
                } else {
                    showSuccess();
                }
            }
            
            // Start first step
            setTimeout(nextStep, 500);
        }

        function showSuccess() {
            progressSection.classList.add('hidden');
            successSection.classList.remove('hidden');
            feather.replace();
            EduTrackAI.showNotification('Analyse terminée avec succès !', 'success');
        }

        function startNewAnalysis() {
            // Reset everything
            uploadForm.parentElement.style.display = 'block';
            progressSection.classList.add('hidden');
            successSection.classList.add('hidden');
            
            // Reset form
            uploadForm.reset();
            dropContent.classList.remove('hidden');
            filePreview.classList.add('hidden');
            
            // Reset progress steps
            const steps = ['step1', 'step2', 'step3', 'step4'];
            steps.forEach(stepId => {
                const stepElement = document.getElementById(stepId);
                stepElement.classList.remove('text-green-600');
                stepElement.classList.add('text-gray-500');
                stepElement.querySelector('.w-6').classList.remove('border-green-500', 'bg-green-500');
                stepElement.querySelector('.w-6').classList.add('border-gray-300');
                stepElement.querySelector('.w-2').classList.remove('bg-white');
                stepElement.querySelector('.w-2').classList.add('bg-gray-300');
            });
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = 'Initialisation...';
        }

        // Auto-detection toggle functionality
        const autoDetectCheckbox = document.getElementById('autoDetectStudent');
        const studentSelect = document.getElementById('student');
        
        autoDetectCheckbox.addEventListener('change', function() {
            if (this.checked) {
                // Disable manual selection when auto-detection is enabled
                studentSelect.disabled = true;
                studentSelect.classList.add('bg-gray-100', 'text-gray-500', 'cursor-not-allowed');
                studentSelect.classList.remove('bg-white');
                studentSelect.value = '';
                studentSelect.removeAttribute('required');
                
                // Show notification
                EduTrackAI.showNotification('Détection automatique activée. Le nom sera extrait de la copie.', 'info');
            } else {
                // Re-enable manual selection
                studentSelect.disabled = false;
                studentSelect.classList.remove('bg-gray-100', 'text-gray-500', 'cursor-not-allowed');
                studentSelect.classList.add('bg-white');
                studentSelect.setAttribute('required', 'required');
                
                // Show notification
                EduTrackAI.showNotification('Sélection manuelle réactivée.', 'info');
            }
        });

        // Auto-fill demo data
        setTimeout(() => {
            document.getElementById('student').value = 'lucas-dubois';
            document.getElementById('assignment').value = 'Rédaction - Mon voyage imaginaire - 15/04/2025';
            document.getElementById('subject').value = 'redaction';
        }, 1000);
    </script>
</body>
</html> 